/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package cashier;

import componentControl.AutoGenerate;
import componentControl.FillComboBox;
import control.ServiceOrderControl;
import java.awt.event.KeyAdapter;
import java.awt.event.KeyEvent;
import java.sql.SQLException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Map;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JComboBox;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JTextField;
import model.Invoice;
import model.ServiceItem;
import model.ServiceOrder;

/**
 *
 * @author Amila
 */
public class InvoiceView extends javax.swing.JPanel {
    CashierMain cashierMain;
    JPanel pan;
    Map<String, Object> modelList;
    /**
     * Creates new form Invoice
     */
    public InvoiceView(CashierMain cashierMain,JPanel pan) {
        initComponents();
        this.cashierMain=cashierMain;
        this.pan=pan;
        FillComboBox.fillComboDatabase(cmbServiceOrderID, "ServiceOrder", "Service_Order_ID");
        txtInvoiceNo.setText(AutoGenerate.getNextID("ServiceInvoice", "Invoice_No", "IN"));
        comboControl(cmbServiceOrderID);
        txtServiceOrderID.setVisible(false);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLayeredPane1 = new javax.swing.JLayeredPane();
        jLayeredPane2 = new javax.swing.JLayeredPane();
        lbPaymentMode = new javax.swing.JLabel();
        cmbPaymentMode = new javax.swing.JComboBox();
        lbInvoiceNo = new javax.swing.JLabel();
        txtInvoiceNo = new javax.swing.JTextField();
        lbAmount = new javax.swing.JLabel();
        lbBalance = new javax.swing.JLabel();
        txtBalance = new javax.swing.JTextField();
        txtAmount = new javax.swing.JTextField();
        lbCustomerBalance = new javax.swing.JLabel();
        txtCustomerBalance = new javax.swing.JTextField();
        btPay = new javax.swing.JButton();
        btItemIssue = new javax.swing.JButton();
        jLayeredPane3 = new javax.swing.JLayeredPane();
        lbServiceOrderID = new javax.swing.JLabel();
        cmbServiceOrderID = new javax.swing.JComboBox();
        lbCurrentCost = new javax.swing.JLabel();
        txtTotalCost = new javax.swing.JTextField();
        lbcmbItemDescription = new javax.swing.JLabel();
        txtItemDescription = new javax.swing.JTextField();
        txtAdvancedPayment = new javax.swing.JTextField();
        lbAdvancedPayment = new javax.swing.JLabel();
        txtServiceOrderID = new javax.swing.JTextField();
        jLayeredPane5 = new javax.swing.JLayeredPane();

        setOpaque(false);

        jLayeredPane2.setBorder(javax.swing.BorderFactory.createTitledBorder("Invoice"));

        lbPaymentMode.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbPaymentMode.setText("Payment Mode");
        lbPaymentMode.setBounds(50, 100, 130, 15);
        jLayeredPane2.add(lbPaymentMode, javax.swing.JLayeredPane.DEFAULT_LAYER);

        cmbPaymentMode.setEditable(true);
        cmbPaymentMode.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        cmbPaymentMode.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Advance", "Full Payment", "Balance" }));
        cmbPaymentMode.setBounds(210, 100, 180, 25);
        jLayeredPane2.add(cmbPaymentMode, javax.swing.JLayeredPane.DEFAULT_LAYER);

        lbInvoiceNo.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        lbInvoiceNo.setText("Invoice No");
        lbInvoiceNo.setBounds(30, 30, 140, 20);
        jLayeredPane2.add(lbInvoiceNo, javax.swing.JLayeredPane.DEFAULT_LAYER);

        txtInvoiceNo.setEditable(false);
        txtInvoiceNo.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        txtInvoiceNo.setBounds(170, 30, 170, 30);
        jLayeredPane2.add(txtInvoiceNo, javax.swing.JLayeredPane.DEFAULT_LAYER);

        lbAmount.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbAmount.setText("Amount");
        lbAmount.setBounds(440, 100, 140, 20);
        jLayeredPane2.add(lbAmount, javax.swing.JLayeredPane.DEFAULT_LAYER);

        lbBalance.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbBalance.setText("Balance");
        lbBalance.setBounds(50, 160, 140, 20);
        jLayeredPane2.add(lbBalance, javax.swing.JLayeredPane.DEFAULT_LAYER);

        txtBalance.setEditable(false);
        txtBalance.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        txtBalance.setBounds(210, 160, 120, 25);
        jLayeredPane2.add(txtBalance, javax.swing.JLayeredPane.DEFAULT_LAYER);

        txtAmount.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        txtAmount.setBounds(600, 100, 120, 25);
        jLayeredPane2.add(txtAmount, javax.swing.JLayeredPane.DEFAULT_LAYER);

        lbCustomerBalance.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbCustomerBalance.setText("Customer Balance");
        lbCustomerBalance.setBounds(440, 160, 140, 20);
        jLayeredPane2.add(lbCustomerBalance, javax.swing.JLayeredPane.DEFAULT_LAYER);

        txtCustomerBalance.setEditable(false);
        txtCustomerBalance.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        txtCustomerBalance.setBounds(600, 160, 120, 25);
        jLayeredPane2.add(txtCustomerBalance, javax.swing.JLayeredPane.DEFAULT_LAYER);

        jLayeredPane2.setBounds(20, 250, 820, 210);
        jLayeredPane1.add(jLayeredPane2, javax.swing.JLayeredPane.DEFAULT_LAYER);

        btPay.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        btPay.setText("Pay");
        btPay.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btPayActionPerformed(evt);
            }
        });
        btPay.setBounds(580, 480, 120, 30);
        jLayeredPane1.add(btPay, javax.swing.JLayeredPane.DEFAULT_LAYER);

        btItemIssue.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        btItemIssue.setText("Item Issue");
        btItemIssue.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btItemIssueActionPerformed(evt);
            }
        });
        btItemIssue.setBounds(710, 480, 120, 30);
        jLayeredPane1.add(btItemIssue, javax.swing.JLayeredPane.DEFAULT_LAYER);

        jLayeredPane3.setBorder(javax.swing.BorderFactory.createTitledBorder("Service Order Detail"));

        lbServiceOrderID.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbServiceOrderID.setText("Service Order ID");
        lbServiceOrderID.setBounds(20, 30, 110, 15);
        jLayeredPane3.add(lbServiceOrderID, javax.swing.JLayeredPane.DEFAULT_LAYER);

        cmbServiceOrderID.setEditable(true);
        cmbServiceOrderID.setBounds(180, 30, 130, 25);
        jLayeredPane3.add(cmbServiceOrderID, javax.swing.JLayeredPane.DEFAULT_LAYER);

        lbCurrentCost.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbCurrentCost.setText("Current Cost Amount");
        lbCurrentCost.setBounds(20, 90, 150, 15);
        jLayeredPane3.add(lbCurrentCost, javax.swing.JLayeredPane.DEFAULT_LAYER);

        txtTotalCost.setEditable(false);
        txtTotalCost.setBounds(180, 90, 120, 25);
        jLayeredPane3.add(txtTotalCost, javax.swing.JLayeredPane.DEFAULT_LAYER);

        lbcmbItemDescription.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbcmbItemDescription.setText("Item Description");
        lbcmbItemDescription.setBounds(360, 30, 110, 15);
        jLayeredPane3.add(lbcmbItemDescription, javax.swing.JLayeredPane.DEFAULT_LAYER);

        txtItemDescription.setEditable(false);
        txtItemDescription.setBounds(500, 30, 260, 25);
        jLayeredPane3.add(txtItemDescription, javax.swing.JLayeredPane.DEFAULT_LAYER);

        txtAdvancedPayment.setEditable(false);
        txtAdvancedPayment.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        txtAdvancedPayment.setBounds(520, 90, 120, 25);
        jLayeredPane3.add(txtAdvancedPayment, javax.swing.JLayeredPane.DEFAULT_LAYER);

        lbAdvancedPayment.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbAdvancedPayment.setText("Advanced Payment");
        lbAdvancedPayment.setBounds(360, 90, 140, 20);
        jLayeredPane3.add(lbAdvancedPayment, javax.swing.JLayeredPane.DEFAULT_LAYER);

        txtServiceOrderID.setEditable(false);
        txtServiceOrderID.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        txtServiceOrderID.setBounds(180, 30, 130, 25);
        jLayeredPane3.add(txtServiceOrderID, javax.swing.JLayeredPane.DEFAULT_LAYER);

        jLayeredPane3.setBounds(20, 90, 820, 130);
        jLayeredPane1.add(jLayeredPane3, javax.swing.JLayeredPane.DEFAULT_LAYER);

        jLayeredPane5.setBorder(javax.swing.BorderFactory.createMatteBorder(1, 1, 60, 400, new javax.swing.ImageIcon(getClass().getResource("/pictures/cashier/Invoice.png")))); // NOI18N
        jLayeredPane5.setBounds(0, 0, 290, 60);
        jLayeredPane1.add(jLayeredPane5, javax.swing.JLayeredPane.DEFAULT_LAYER);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jLayeredPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 860, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jLayeredPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 530, Short.MAX_VALUE)
        );
    }// </editor-fold>//GEN-END:initComponents

    private void btPayActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btPayActionPerformed
      addInvoice();
      //clear();
      //checkEmpty();
    }//GEN-LAST:event_btPayActionPerformed

    private void btItemIssueActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btItemIssueActionPerformed
       // addTable();
    }//GEN-LAST:event_btItemIssueActionPerformed

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btItemIssue;
    private javax.swing.JButton btPay;
    private javax.swing.JComboBox cmbPaymentMode;
    private javax.swing.JComboBox cmbServiceOrderID;
    private javax.swing.JLayeredPane jLayeredPane1;
    private javax.swing.JLayeredPane jLayeredPane2;
    private javax.swing.JLayeredPane jLayeredPane3;
    private javax.swing.JLayeredPane jLayeredPane5;
    private javax.swing.JLabel lbAdvancedPayment;
    private javax.swing.JLabel lbAmount;
    private javax.swing.JLabel lbBalance;
    private javax.swing.JLabel lbCurrentCost;
    private javax.swing.JLabel lbCustomerBalance;
    private javax.swing.JLabel lbInvoiceNo;
    private javax.swing.JLabel lbPaymentMode;
    private javax.swing.JLabel lbServiceOrderID;
    private javax.swing.JLabel lbcmbItemDescription;
    private javax.swing.JTextField txtAdvancedPayment;
    private javax.swing.JTextField txtAmount;
    private javax.swing.JTextField txtBalance;
    private javax.swing.JTextField txtCustomerBalance;
    private javax.swing.JTextField txtInvoiceNo;
    private javax.swing.JTextField txtItemDescription;
    private javax.swing.JTextField txtServiceOrderID;
    private javax.swing.JTextField txtTotalCost;
    // End of variables declaration//GEN-END:variables

    private void viewInvoice(){
        ServiceOrder serviceOrder=new ServiceOrder();
        serviceOrder.setService_Order_ID(cmbServiceOrderID.getSelectedItem()+"");
        try {
            modelList=ServiceOrderControl.viewInvoice(serviceOrder);
        } catch (ClassNotFoundException ex) {
            Logger.getLogger(InvoiceView.class.getName()).log(Level.SEVERE, null, ex);
        } catch (SQLException ex) {
            Logger.getLogger(InvoiceView.class.getName()).log(Level.SEVERE, null, ex);
        }
        serviceOrder=(ServiceOrder) modelList.get("ServiceOrder");
        ServiceItem item=(ServiceItem) modelList.get("Item");
        txtServiceOrderID.setText(serviceOrder.getService_Order_ID());
        txtItemDescription.setText(item.getDescription());
        txtTotalCost.setText(serviceOrder.getTotal_Cost_Amount()+"");
        ArrayList<Invoice> invoiceList=(ArrayList<Invoice>) modelList.get("InvoiceList");
        double advancedAmount=0.00;
        for (Invoice invoice : invoiceList) {
            advancedAmount+=invoice.getAmount();
        }
        txtAdvancedPayment.setText(advancedAmount+"");
    }
    private void comboControl(JComboBox controlcmb){
        JTextField txt = (JTextField) controlcmb.getEditor().getEditorComponent();
        txt.addKeyListener(new KeyAdapter() {
            public void keyReleased(KeyEvent evt) {
                if (evt.getKeyCode() == KeyEvent.VK_ENTER) {
                    viewInvoice();
                }
            }
        });
    }
    private void addInvoice(){
        Invoice invoice=new Invoice(txtInvoiceNo.getText(), setDateTime(), Double.parseDouble(txtAmount.getText()), txtServiceOrderID.getText());
        try {
            int res=ServiceOrderControl.addInvoice(invoice);
            if(res==1){
               JOptionPane.showMessageDialog(pan, "Invoice OK...", "Success", JOptionPane.INFORMATION_MESSAGE);
           }else{
               JOptionPane.showMessageDialog(pan, "Invoice Fail", "Fail", JOptionPane.ERROR_MESSAGE);
           }
        } catch (ClassNotFoundException ex) {
            Logger.getLogger(InvoiceView.class.getName()).log(Level.SEVERE, null, ex);
        } catch (SQLException ex) {
            Logger.getLogger(InvoiceView.class.getName()).log(Level.SEVERE, null, ex);
        }
    }
    private String setDateTime(){
       SimpleDateFormat SDF=new SimpleDateFormat("yyyy-MM-dd hh:mm:ss");
       String Date=SDF.format(Calendar.getInstance().getTime());
       System.out.println(Date);
       return Date;
    }
}
