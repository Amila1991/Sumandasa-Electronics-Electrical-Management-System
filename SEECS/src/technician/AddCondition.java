/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * AddCondition.java
 *
 * Created on Feb 14, 2012, 12:03:14 AM
 */

package technician;

import componentControl.FillComboBox;
import control.ServiceOrderControl;
import java.awt.event.KeyAdapter;
import java.awt.event.KeyEvent;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.Map;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.DefaultListModel;
import javax.swing.JComboBox;
import javax.swing.JTextField;
import model.Condition;
import model.Customer;
import model.ServiceItem;
import model.ServiceOrder;

/**
 *
 * @author Amila Karunathilaka
 */
public class AddCondition extends javax.swing.JPanel {
    DefaultListModel<String> dlm;
    Map<String, Object> modelList;
    String itemCode;
    /** Creates new form AddCondition */
    public AddCondition() {
        initComponents();
        dlm=new DefaultListModel();
        FillComboBox.fillComboDatabase(cmbServiceOrder, "ServiceOrder so NATURAL JOIN Item i NATURAL LEFT JOIN Conditions c where c.Item_Code is null", "Service_Order_ID");
        comboControl(cmbServiceOrder);
        checkAddBt();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLayeredPane1 = new javax.swing.JLayeredPane();
        btSearch = new javax.swing.JButton();
        cmbServiceOrder = new javax.swing.JComboBox();
        jLayeredPane2 = new javax.swing.JLayeredPane();
        lbCustName = new javax.swing.JLabel();
        lbCustAddress = new javax.swing.JLabel();
        lbContactNo = new javax.swing.JLabel();
        txtCustName = new javax.swing.JTextField();
        txtContactNo = new javax.swing.JTextField();
        txtCustAddress = new javax.swing.JTextField();
        jLayeredPane3 = new javax.swing.JLayeredPane();
        txtItemDescription = new javax.swing.JTextField();
        lbItemDescrription = new javax.swing.JLabel();
        txtSerialNo = new javax.swing.JTextField();
        lbItemModelNo = new javax.swing.JLabel();
        lbItemSerialNo = new javax.swing.JLabel();
        lbItemBrandName = new javax.swing.JLabel();
        txtBrandName = new javax.swing.JTextField();
        txtModelNo = new javax.swing.JTextField();
        lbServiceOrderID1 = new javax.swing.JLabel();
        jLayeredPane4 = new javax.swing.JLayeredPane();
        lbAddCondition = new javax.swing.JLabel();
        txtAddCondition = new javax.swing.JTextField();
        btmoveCondition = new javax.swing.JButton();
        jScrollPane1 = new javax.swing.JScrollPane();
        listItemCondition = new javax.swing.JList();
        btAdd = new javax.swing.JButton();

        setOpaque(false);

        btSearch.setText("Search");
        btSearch.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btSearchActionPerformed(evt);
            }
        });
        btSearch.setBounds(290, 60, 90, 23);
        jLayeredPane1.add(btSearch, javax.swing.JLayeredPane.DEFAULT_LAYER);

        cmbServiceOrder.setEditable(true);
        cmbServiceOrder.setBounds(150, 60, 120, 25);
        jLayeredPane1.add(cmbServiceOrder, javax.swing.JLayeredPane.DEFAULT_LAYER);

        jLayeredPane2.setBorder(javax.swing.BorderFactory.createTitledBorder("Customer Detail"));

        lbCustName.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbCustName.setText("Customer Name");
        lbCustName.setBounds(20, 30, 120, 15);
        jLayeredPane2.add(lbCustName, javax.swing.JLayeredPane.DEFAULT_LAYER);

        lbCustAddress.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbCustAddress.setText("Customer Address");
        lbCustAddress.setBounds(20, 70, 130, 15);
        jLayeredPane2.add(lbCustAddress, javax.swing.JLayeredPane.DEFAULT_LAYER);

        lbContactNo.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbContactNo.setText("Contact No.");
        lbContactNo.setBounds(460, 30, 90, 15);
        jLayeredPane2.add(lbContactNo, javax.swing.JLayeredPane.DEFAULT_LAYER);

        txtCustName.setEditable(false);
        txtCustName.setBounds(150, 30, 290, 25);
        jLayeredPane2.add(txtCustName, javax.swing.JLayeredPane.DEFAULT_LAYER);

        txtContactNo.setEditable(false);
        txtContactNo.setBounds(550, 30, 190, 25);
        jLayeredPane2.add(txtContactNo, javax.swing.JLayeredPane.DEFAULT_LAYER);

        txtCustAddress.setEditable(false);
        txtCustAddress.setBounds(150, 70, 430, 25);
        jLayeredPane2.add(txtCustAddress, javax.swing.JLayeredPane.DEFAULT_LAYER);

        jLayeredPane2.setBounds(30, 100, 800, 110);
        jLayeredPane1.add(jLayeredPane2, javax.swing.JLayeredPane.DEFAULT_LAYER);

        jLayeredPane3.setBorder(javax.swing.BorderFactory.createTitledBorder("Item Detail"));

        txtItemDescription.setEditable(false);
        txtItemDescription.setBounds(150, 70, 290, 25);
        jLayeredPane3.add(txtItemDescription, javax.swing.JLayeredPane.DEFAULT_LAYER);

        lbItemDescrription.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbItemDescrription.setText("Item Descrription");
        lbItemDescrription.setBounds(20, 70, 130, 15);
        jLayeredPane3.add(lbItemDescrription, javax.swing.JLayeredPane.DEFAULT_LAYER);

        txtSerialNo.setEditable(false);
        txtSerialNo.setBounds(590, 30, 190, 25);
        jLayeredPane3.add(txtSerialNo, javax.swing.JLayeredPane.DEFAULT_LAYER);

        lbItemModelNo.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbItemModelNo.setText("Model No ");
        lbItemModelNo.setBounds(20, 40, 110, 15);
        jLayeredPane3.add(lbItemModelNo, javax.swing.JLayeredPane.DEFAULT_LAYER);

        lbItemSerialNo.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbItemSerialNo.setText("Serial No");
        lbItemSerialNo.setBounds(470, 30, 80, 15);
        jLayeredPane3.add(lbItemSerialNo, javax.swing.JLayeredPane.DEFAULT_LAYER);

        lbItemBrandName.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbItemBrandName.setText("Item Brand Name");
        lbItemBrandName.setBounds(470, 70, 120, 15);
        jLayeredPane3.add(lbItemBrandName, javax.swing.JLayeredPane.DEFAULT_LAYER);

        txtBrandName.setEditable(false);
        txtBrandName.setBounds(590, 70, 160, 25);
        jLayeredPane3.add(txtBrandName, javax.swing.JLayeredPane.DEFAULT_LAYER);

        txtModelNo.setEditable(false);
        txtModelNo.setBounds(150, 30, 190, 25);
        jLayeredPane3.add(txtModelNo, javax.swing.JLayeredPane.DEFAULT_LAYER);

        jLayeredPane3.setBounds(30, 210, 800, 110);
        jLayeredPane1.add(jLayeredPane3, javax.swing.JLayeredPane.DEFAULT_LAYER);

        lbServiceOrderID1.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbServiceOrderID1.setText("Service Order ID");
        lbServiceOrderID1.setBounds(30, 60, 110, 20);
        jLayeredPane1.add(lbServiceOrderID1, javax.swing.JLayeredPane.DEFAULT_LAYER);

        jLayeredPane4.setBorder(javax.swing.BorderFactory.createTitledBorder("Condition"));

        lbAddCondition.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbAddCondition.setText("Add Item Condition");
        lbAddCondition.setBounds(20, 40, 170, 15);
        jLayeredPane4.add(lbAddCondition, javax.swing.JLayeredPane.DEFAULT_LAYER);

        txtAddCondition.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtAddConditionActionPerformed(evt);
            }
        });
        txtAddCondition.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtAddConditionKeyReleased(evt);
            }
        });
        txtAddCondition.setBounds(20, 70, 280, 25);
        jLayeredPane4.add(txtAddCondition, javax.swing.JLayeredPane.DEFAULT_LAYER);

        btmoveCondition.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        btmoveCondition.setText(">>");
        btmoveCondition.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btmoveConditionActionPerformed(evt);
            }
        });
        btmoveCondition.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                btmoveConditionKeyReleased(evt);
            }
        });
        btmoveCondition.setBounds(320, 70, 53, 30);
        jLayeredPane4.add(btmoveCondition, javax.swing.JLayeredPane.DEFAULT_LAYER);

        listItemCondition.setBorder(javax.swing.BorderFactory.createTitledBorder("Item Condition"));
        jScrollPane1.setViewportView(listItemCondition);

        jScrollPane1.setBounds(400, 20, 380, 130);
        jLayeredPane4.add(jScrollPane1, javax.swing.JLayeredPane.DEFAULT_LAYER);

        jLayeredPane4.setBounds(30, 320, 800, 160);
        jLayeredPane1.add(jLayeredPane4, javax.swing.JLayeredPane.DEFAULT_LAYER);

        btAdd.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        btAdd.setText("Submit Condition");
        btAdd.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btAddActionPerformed(evt);
            }
        });
        btAdd.setBounds(690, 490, 150, 30);
        jLayeredPane1.add(btAdd, javax.swing.JLayeredPane.DEFAULT_LAYER);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jLayeredPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 860, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jLayeredPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 530, javax.swing.GroupLayout.PREFERRED_SIZE)
        );
    }// </editor-fold>//GEN-END:initComponents

    private void btSearchActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btSearchActionPerformed
       viewServiceOrder();
       checkAddBt();
}//GEN-LAST:event_btSearchActionPerformed

    private void btmoveConditionActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btmoveConditionActionPerformed
        addList();
        checkAddBt();
    }//GEN-LAST:event_btmoveConditionActionPerformed

    private void btAddActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btAddActionPerformed
       addCondition();
       checkAddBt();
    }//GEN-LAST:event_btAddActionPerformed

    private void txtAddConditionActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtAddConditionActionPerformed
        
    }//GEN-LAST:event_txtAddConditionActionPerformed

    private void btmoveConditionKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_btmoveConditionKeyReleased
        checkAddBt();
    }//GEN-LAST:event_btmoveConditionKeyReleased

    private void txtAddConditionKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtAddConditionKeyReleased
        checkAddBt();
        if(evt.getKeyCode()==KeyEvent.VK_ENTER){
            if(!txtAddCondition.getText().trim().isEmpty()){
                addList();
                checkAddBt();
            }
        }
    }//GEN-LAST:event_txtAddConditionKeyReleased


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btAdd;
    private javax.swing.JButton btSearch;
    private javax.swing.JButton btmoveCondition;
    private javax.swing.JComboBox cmbServiceOrder;
    private javax.swing.JLayeredPane jLayeredPane1;
    private javax.swing.JLayeredPane jLayeredPane2;
    private javax.swing.JLayeredPane jLayeredPane3;
    private javax.swing.JLayeredPane jLayeredPane4;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JLabel lbAddCondition;
    private javax.swing.JLabel lbContactNo;
    private javax.swing.JLabel lbCustAddress;
    private javax.swing.JLabel lbCustName;
    private javax.swing.JLabel lbItemBrandName;
    private javax.swing.JLabel lbItemDescrription;
    private javax.swing.JLabel lbItemModelNo;
    private javax.swing.JLabel lbItemSerialNo;
    private javax.swing.JLabel lbServiceOrderID1;
    private javax.swing.JList listItemCondition;
    private javax.swing.JTextField txtAddCondition;
    private javax.swing.JTextField txtBrandName;
    private javax.swing.JTextField txtContactNo;
    private javax.swing.JTextField txtCustAddress;
    private javax.swing.JTextField txtCustName;
    private javax.swing.JTextField txtItemDescription;
    private javax.swing.JTextField txtModelNo;
    private javax.swing.JTextField txtSerialNo;
    // End of variables declaration//GEN-END:variables
    private void viewServiceOrder() {
        ServiceOrder serviceOrder=new ServiceOrder();
        serviceOrder.setService_Order_ID(cmbServiceOrder.getSelectedItem()+"");
        try {
            modelList=ServiceOrderControl.viewServiceOrder(serviceOrder);
        } catch (ClassNotFoundException ex) {
            Logger.getLogger(AddCondition.class.getName()).log(Level.SEVERE, null, ex);
        } catch (SQLException ex) {
            Logger.getLogger(AddCondition.class.getName()).log(Level.SEVERE, null, ex);
        }
        serviceOrder=(ServiceOrder)modelList.get("ServiceOrder");
        Customer customer=(Customer)modelList.get("Customer");
        ServiceItem item=(ServiceItem)modelList.get("Item");
        txtCustName.setText(customer.getCustName());
        txtCustAddress.setText(customer.getCustAddress());
        txtContactNo.setText(customer.getContactNo());
        txtModelNo.setText(item.getModel_No());
        txtSerialNo.setText(item.getSerial_No());
        txtItemDescription.setText(item.getDescription());
        txtBrandName.setText(item.getItem_Brand_Name());
        itemCode=item.getItem_Code();
    }
    
    private void addList(){
        dlm.addElement(txtAddCondition.getText());
        listItemCondition.setModel(dlm);
        txtAddCondition.setText("");
        txtAddCondition.requestFocus();
    }
    private void addCondition() {
        ArrayList<Condition> conditionList=new ArrayList<Condition>();
        Condition condition=null;
        for (int i=0;i<dlm.getSize();i++) {
            condition=new Condition(i+1, dlm.get(i), itemCode);
            conditionList.add(condition);
        }
        try {
            int res = ServiceOrderControl.addCondition(conditionList);
        } catch (ClassNotFoundException ex) {
            Logger.getLogger(AddCondition.class.getName()).log(Level.SEVERE, null, ex);
        } catch (SQLException ex) {
            Logger.getLogger(AddCondition.class.getName()).log(Level.SEVERE, null, ex);
        }
        clear();
    }
    private void checkAddBt(){
        if (itemCode==null) {
            btAdd.setEnabled(false);
        }else{
            btAdd.setEnabled(true);
        }
        if(txtAddCondition.getText().trim().isEmpty()){
            btmoveCondition.setEnabled(false);
        }else{
            btmoveCondition.setEnabled(true);
        }
    }
    private void clear(){
        FillComboBox.fillComboDatabase(cmbServiceOrder, "ServiceOrder so NATURAL JOIN Item i NATURAL LEFT JOIN Conditions c where c.Item_Code is null", "Service_Order_ID");
        txtCustName.setText("");
        txtCustAddress.setText("");
        txtContactNo.setText("");
        txtBrandName.setText("");
        txtModelNo.setText("");
        txtSerialNo.setText("");
        txtItemDescription.setText("");
        dlm=new DefaultListModel<String>();
        listItemCondition.setModel(dlm);
    }
    private void comboControl(JComboBox controlcmb){
        JTextField txt = (JTextField) controlcmb.getEditor().getEditorComponent();
        txt.addKeyListener(new KeyAdapter() {
            public void keyReleased(KeyEvent evt) {
                if (evt.getKeyCode() == KeyEvent.VK_ENTER) {
                    viewServiceOrder();
                }
            }
        });
    }

}
